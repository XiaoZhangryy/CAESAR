<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Annotate Cells Using Distance Matrix and Marker Frequencies — annotation_mat • CAESAR.Suite</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Annotate Cells Using Distance Matrix and Marker Frequencies — annotation_mat"><meta property="og:description" content="This function annotates cells based on a cell-gene distance matrix and marker gene frequencies. It computes the average distances, optionally calculates confidence levels for the predictions, and computes cell mixing proportions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CAESAR.Suite</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/STMOB.html">ST MOB data analysis</a>
    </li>
    <li>
      <a href="../articles/XeniumBC.html">Xenium BC data analysis</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/XiaoZhangryy/CAESAR.Suite/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Annotate Cells Using Distance Matrix and Marker Frequencies</h1>
    <small class="dont-index">Source: <a href="https://github.com/XiaoZhangryy/CAESAR.Suite/blob/HEAD/R/caesar_annotation.R" class="external-link"><code>R/caesar_annotation.R</code></a></small>
    <div class="hidden name"><code>annotation_mat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function annotates cells based on a cell-gene distance matrix and marker gene frequencies. It computes the average distances, optionally calculates confidence levels for the predictions, and computes cell mixing proportions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">annotation_mat</span><span class="op">(</span></span>
<span>  <span class="va">distce</span>,</span>
<span>  <span class="va">marker.freq</span>,</span>
<span>  gene.use <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cal.confidence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cal.proportions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  n_fake <span class="op">=</span> <span class="fl">1001</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  unassign <span class="op">=</span> <span class="st">"unassigned"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>distce</dt>
<dd><p>A matrix of distances between spots and genes. Rows represent genes, and columns represent cells. Generally, it is a list of the output of function <code><a href="https://rdrr.io/pkg/ProFAST/man/pdistance.html" class="external-link">ProFAST::pdistance</a></code> with CAESAR co-embedding as input.</p></dd>


<dt>marker.freq</dt>
<dd><p>A matrix where rows represent cell types, and columns represent marker genes. The values in the matrix represent the frequency or weight of each marker gene for each cell type. Generally, it is a list of the output of function <code>markerList2mat</code>.</p></dd>


<dt>gene.use</dt>
<dd><p>A character vector specifying which genes to use for the annotation. If `NULL`, all genes in `distce` will be used. Default is `NULL`.</p></dd>


<dt>cal.confidence</dt>
<dd><p>Logical, indicating whether to calculate the confidence of the predictions. Default is `TRUE`.</p></dd>


<dt>cal.proportions</dt>
<dd><p>Logical, indicating whether to calculate the mixing proportions of cell types for each spot. Default is `TRUE`.</p></dd>


<dt>parallel</dt>
<dd><p>Logical, indicating whether to run the confidence calculation in parallel. Default is `TRUE`.</p></dd>


<dt>ncores</dt>
<dd><p>The number of cores to use for parallel computation. Default is 10.</p></dd>


<dt>n_fake</dt>
<dd><p>The number of fake (randomized) distance matrices to simulate for confidence calculation. Default is 1001.</p></dd>


<dt>seed</dt>
<dd><p>The random seed for reproducibility. Default is 1.</p></dd>


<dt>threshold</dt>
<dd><p>A numeric value specifying the confidence threshold below which a cell is labeled as `unassigned`. Default is 0.95.</p></dd>


<dt>unassign</dt>
<dd><p>A character string representing the label to assign to cells below the confidence threshold. Default is `"unassigned"`.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with the following components:</p>
<dl><dt>ave.dist</dt>
<dd><p>A matrix of average distances between each cell and each cell type.</p></dd>

<dt>confidence</dt>
<dd><p>A numeric vector of confidence values for each cell (if `cal.confidence = TRUE`).</p></dd>

<dt>pred</dt>
<dd><p>A character vector of predicted cell types for each cell.</p></dd>

<dt>pred_unassign</dt>
<dd><p>A character vector of predicted cell types with cells below the confidence threshold labeled as `unassigned` (if `cal.confidence = TRUE`).</p></dd>

<dt>cell_mixing_proportions</dt>
<dd><p>A matrix of mixing proportions for each spot across the different cell types (if `cal.proportions = TRUE`).</p></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="marker.select.html">marker.select</a></code> for select markers.
<code><a href="find.sig.genes.html">find.sig.genes</a></code> for signature gene list.
<code><a href="markerList2mat.html">markerList2mat</a></code> for marker frequency matrix.
<code><a href="https://rdrr.io/pkg/ProFAST/man/pdistance.html" class="external-link">pdistance</a></code> for obtain cell-gene distance matrix using co-embedding.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">toydata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="va">toydata</span><span class="op">$</span><span class="va">seu</span></span></span>
<span class="r-in"><span><span class="va">markers</span> <span class="op">&lt;-</span> <span class="va">toydata</span><span class="op">$</span><span class="va">markers</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu">ProFAST</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ProFAST/man/pdistance.html" class="external-link">pdistance</a></span><span class="op">(</span><span class="va">seu</span>, reduction <span class="op">=</span> <span class="st">"caesar"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Calculate co-embedding distance...</span>
<span class="r-in"><span><span class="va">distce</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">seu</span>, slot <span class="op">=</span> <span class="st">"data"</span>, assay <span class="op">=</span> <span class="st">"distce"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">marker.freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="markerList2mat.html">markerList2mat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">markers</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">anno_res</span> <span class="op">&lt;-</span> <span class="fu">annotation_mat</span><span class="op">(</span><span class="va">distce</span>, <span class="va">marker.freq</span>, cal.confidence <span class="op">=</span> <span class="cn">FALSE</span>, cal.proportions <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">anno_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ ave.dist               : num [1:3000, 1:8] 28.4 24.9 27 25 34.2 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..- attr(*, "dimnames")=List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : chr [1:3000] "24387" "4049" "11570" "25172" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : chr [1:8] "CAFs" "Cancer Epithelial" "Endothelial" "Myeloid" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ confidence             : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ pred                   : chr [1:3000] "Cancer Epithelial" "Cancer Epithelial" "Cancer Epithelial" "Cancer Epithelial" ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ pred_unassign          : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ cell_mixing_proportions: NULL</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Xiao Zhang, Wei Liu, Jin Liu.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

